{
  "variables": {
    "ENVIRONMENT": "{{env `RIKLEIMT_ENV`}}",
    "VERSION": "{{env `VERSION`}}",
    "APP_NAME": "rikleimt"
  },
  "builders": [
    {
      "type": "amazon-ebs",
      "region": "us-west-2",
      "source_ami": "ami-e7527ed7",
      "instance_type": "t1.micro",
      "ssh_username": "ec2-user",
      "ami_name": "{{user `APP_NAME`}}-{{ user `ENVIRONMENT` }}-{{ user `VERSION` }} - {{timestamp}}",
      "run_tags": {
        "Name": "Packer builder for {{user `APP_NAME`}} - {{timestamp}}",
        "APP_NAME": "{{user `APP_NAME`}}",
        "AMI_VERSION": "{{user `VERSION`}}"
      },
      "ami_block_device_mappings": [
        {
          "device_name": "/dev/xvda",
          "volume_size": 100,
          "volume_type": "gp2",
          "delete_on_termination": true
        }
      ],
      "iam_instance_profile": "fantasy-config",
      "ssh_timeout": "3m"
    }
  ],
  "provisioners": [
    {
      "type": "file",
      "source": "configs/riak-limits",
      "destination": "/tmp/riak-limits"
    },
    {
      "type": "file",
      "source": "configs/riak.conf.tmpl",
      "destination": "/tmp/riak.conf.tmpl"
    },
    {
      "type": "file",
      "source": "scripts/set_ip.sh",
      "destination": "/tmp/set_ip.sh"
    },
    {
      "type": "file",
      "source": "scripts/join_cluster.sh",
      "destination": "/tmp/join_cluster.sh"
    },
    {
      "type": "file",
      "source": "configs/aws_config",
      "destination": "/tmp/aws_config"
    }
  ]
}
